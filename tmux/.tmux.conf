#==========================================#
# => Plugin
#==========================================#
# List of plugins
#set -g @plugin 'tmux-plugins/tpm'
#set -g @plugin 'tmux-plugins/tmux-sensible'
#set -g @plugin 'dracula/tmux'

#==========================================#
# => General
#==========================================#

# default shell is zsh
set-option -g default-shell /bin/zsh

# color setting
set-option -g default-terminal screen-256color
set -g terminal-overrides 'xterm:colors=256'

# set prefix key Ctrl+a & unbind default setting
set -g prefix C-a
unbind C-b

#Mouse works as expected
setw -g monitor-activity on
set -g visual-activity on


# interval 
set -s escape-time 0
set-option -g status-interval 1

# index
set -g base-index 1
setw -g pane-base-index 1

## Focused pane color
set -g window-style 'bg=colour239'
set -g window-active-style 'bg=colour234'

#==========================================#
# => keybinding
#==========================================#
# Easy config reload
bind-key R source-file ~/.tmux.conf \; display-message "tmux.conf reloaded."

## explor session, window,
bind Space choose-tree

## make new window
bind C-n new-window

## finish pane
bind C-w kill-pane
## finish pane
bind C-q kill-window

## split window
bind-key | split-window -h -c "#{pane_current_path}"
bind-key - split-window -v -c "#{pane_current_path}"

# resize panes with vim movement keys
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Smart pane switching with awareness of Vim splits.
# See: https://github.com/christoomey/vim-tmux-navigator
is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"
bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h'  'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j'  'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k'  'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l'  'select-pane -R'
tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'
if-shell -b '[ "$(echo "$tmux_version < 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\'  'select-pane -l'"
if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\\\'  'select-pane -l'"

bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R
bind-key -T copy-mode-vi 'C-\' select-pane -l

## move window
# I'm using bind pane_number

## move session
# I'm using choose-tree

# Very userful !!!
bind C-l send-keys 'C-l'


#================================================#
# => status line
#================================================#

## window-status's position
set-option -g status-justify "centre"
## status line's backgroundcolor
set-option -g status-bg "colour235"
## status line's color
set-option -g status-fg "colour99"
## status-left's length
set-option -g status-left-length 20
## status-left's format
set-option -g status-left "#[fg=colour235,bg=colour13] [#S:#I:#P]"
## window-status's format
set-window-option -g window-status-format " #I: #W "
## current window's format 
set-window-option -g window-status-current-format "#[fg=colour235,bg=colour99, bold] #I: #W #[default]"
## status-right's length
set-option -g status-right-length 60
## status-right's format
set-option -g status-right "#[fg=colour235,bg=colour99] #h | %m/%d %H:%M:%S#[default]"

#=================================================#
# => Command mode & Copy mode
#=================================================#
## command mode setting
set-window-option -g mode-keys vi
setw -g mode-keys vi
bind-key -T copy-mode-vi v send -X begin-selection

### copy mode & exit with q
bind-key Escape copy-mode \; display "Copy mode!"

## ペースト
##bind v paste-buffer
#
### clipboard
#### ☆MacOS
bind-key -T copy-mode-vi y send-keys -X copy-pipe-and-cancel "pbcopy"
bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "pbcopy"
bind-key -T copy-mode-vi Enter send-keys -X copy-pipe-and-cancel "pbcopy"

#### TODO
#### ☆Linux

#### ☆Windows(WLS)
#bind-key -T copy-mode-vi y send -X copy-pipe-and-cancel "win32yank.exe -i"
#unbind -T copy-mode-vi Enter
#bind-key -T copy-mode-vi Enter send -X copy-pipe-and-cancel "win32yank.exe -i"
#bind-key -T copy-mode-vi MouseDragEnd1Pane send-keys -X copy-pipe-and-cancel "win32yank.exe -i"
#unbind-key -T prefix v
#bind-key v run "win32yank.exe -o | tmux load-buffer - && tmux paste-buffer"

# ======================= Don't write under here ============================== #

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
#run -b '~/.tmux/plugins/tpm/tpm'
